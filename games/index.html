<!DOCTYPE html>
<html>
    <head>
        <title>Games</title>
        <link rel="icon" href="/favicon.png">
        <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/assets/text/css/wicons.css">
        <link rel="stylesheet" href="/assets/text/css/global.css">
        <script src="https://unpkg.com/typewriter-effect@latest/dist/core.js"></script>
        <script src="/assets/text/js/setnavandfooter.js"></script>
        <style>
            body {background: var(--background); margin: 0; font-family: "Manrope"; color: var(--text);}

            .wrap {height: 100vh; width: 100vw; background: var(--background); position: relative; display: flex; align-items: center; justify-content: flex-end; flex-direction: column; text-align: center;}
            .scroll {width: 75%; height: calc(100% - 130px); overflow-y: scroll; overflow-x: hidden; border-left: 1px solid #ffffff66; border-right: 1px solid #ffffff66;}
            .game {height: 100px; width: 100%; display: flex; align-items: center; border-bottom: 1px dashed var(--text-dull);}
            .game img {height: 80px; width: 80px; margin: 10px; border-radius: 8px; box-shadow: 0 0 8px currentColor;}
            .game p {margin: 0; font-size: 18px; font-weight: 400; text-shadow: 0 0 8px currentColor;}
            .game button {height: 40px; width: 80px; background: var(--background-light); color: var(--text); border: none; margin-right: 10px; margin-left: auto; text-shadow: 0 0 4px currentColor; transition: text-shadow 0.2s ease-in-out;}
            .game button:hover {cursor: pointer; text-shadow: 0 0 15px currentColor;}
            #searchbar {height: 30px; width: 60%; padding: 0 8px; margin-bottom: 10px; background: none; border: 2px solid var(--background-light); border-radius: 8px; color: var(--text); font-family: "Manrope";}
            #searchbar:focus {outline: none; box-shadow: 0 0 8px var(--text-dull);}

            @media screen and (max-width: 8in) {
                #wr {font-size: 60px;}
            }
            @media screen and (max-width: 5in) {
                #wr {font-size: 35px;}
                .wrc {height: 300px;}
            }
        </style>
    </head>
    <body>
        <button id="smallnavbtn" onclick="toggleSideNav()"><i class="wicon wicon-bar-menu" id="snbtnsub"></i></button>
        <nav id="navm">
            <!-- js! -->
            
        </nav>
        <nav id="sidenav">
            <!-- js! -->
        </nav>

        <div class="wrap">
            <input placeholder="Search..." id="searchbar" type="text">
            <div class="scroll">
                <div class="game" data-name="1v1.lol">
                    <img src="/assets/image/1v1lol.png">
                    <p>1v1.lol</p>
                    <button onclick="launchGame('1v1.lol', '1v1lol')">Launch</button>
                </div>
                <div class="game" data-name="Rocket Bot Royale">
                    <img src="/assets/image/rbr.png">
                    <p>Rocket Bot Royale</p>
                    <button onclick="launchGame('Rocket Bot Royale', 'g/rbr/')">Launch</button>
                </div>
                <div class="game" data-name="JustFall.lol">
                    <img src="/assets/image/justfall.png">
                    <p>JustFall.lol</p>
                    <button onclick="launchGame('JustFall.lol', 'justfall')">Launch</button>
                </div>
                <div class="game" data-name="Smash Karts">
                    <img src="/assets/image/smashkarts.png">
                    <p>Smash Karts</p>
                    <button onclick="launchGame('Smash Karts', 'g/smashkarts/')">Launch</button>
                </div>
                <div class="game" data-name="Snow Rider 3D">
                    <img src="/assets/image/snowrider3d.png">
                    <p>Snow Rider 3D</p>
                    <button onclick="launchGame('Snow Rider 3D', 'snowrider3d')">Launch</button>
                </div>
                <div class="game" data-name="Drift Boss">
                    <img src="/assets/image/driftboss.png">
                    <p>Drift Boss</p>
                    <button onclick="launchGame('Drift Boss', 'driftboss')">Launch</button>
                </div>
                <div class="game" data-name="Cluster Rush">
                    <img src="/assets/image/clusterrush.png">
                    <p>Cluster Rush</p>
                    <button onclick="launchGame('Cluster Rush', 'clusterrush')">Launch</button>
                </div>
                <div class="game" data-name="CTomb of the Mask">
                    <img src="/assets/image/tombofthemask.png">
                    <p>Tomb of the Mask</p>
                    <button onclick="launchGame('Tomb of the Mask', 'g/tombofthemask/')">Launch</button>
                </div>
                <div class="game" data-name="Bit Planes">
                    <img src="/assets/image/bitplanes.png">
                    <p>Bit Planes</p>
                    <button onclick="launchGame('Bit Planes', 'g/bitplanes')">Launch</button>
                </div>
                <div class="game" data-name="Idle Breakout">
                    <img src="/assets/image/idlebreakout.png">
                    <p>Idle Breakout</p>
                    <button onclick="launchGame('Idle Breakout', 'idlebreakout')">Launch</button>
                </div>
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSdPYkxyycGpLgrK4mE-xBtcjKkm6opMpZxyrKUQKU9PSv_6pw/viewform?usp=sf_link" style="color: var(--text); font-size: 13px;">Game Request Form</a>
                <br><span style="color: var(--text); font-size: 13px;">Joke requests will not be tolerated. Your future requests will be ignored.</span>
            </div>
        </div>

        <footer id="footer">
            <!-- js! -->
        </footer>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const searchbar = document.getElementById('searchbar');
                const games = document.querySelectorAll('.game');
                
                searchbar.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    
                    games.forEach(game => {
                        const gameName = game.getAttribute('data-name').toLowerCase();
                        if (gameName.includes(query)) {
                            game.style.display = '';
                        } else {
                            game.style.display = 'none';
                        }
                    });
                });
            });

            function launchGame(name, id) {
                // Open a new about:blank tab
                const newTab = window.open('about:blank', '_blank');

                if (!newTab) {
                    console.error("Failed to open a new tab. Please check your browser's pop-up blocker settings.");
                    return;
                }

                // Define the content for the new tab
                const htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Loading ${name}</title>
                        <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
                        <script src="https://unpkg.com/typewriter-effect@latest/dist/core.js"><\/script>
                        <style>
                            body {background: #101010;}
                            #wr {color: #00ff00; font-family: "Pixelify Sans", sans-serif; text-shadow: 0 0 8px currentColor;}
                        </style>
                    </head>
                    <body>
                        <span id="wr"></span>
                        <script>
                            // Initialize a variable
                            var sv = 0;

                            // Function to update the variable and notify the parent
                            function updateVariable() {
                                sv = 1;
                                window.opener.postMessage('variableChanged', '*');
                            }

                            // Simulate variable change after some time
                            setTimeout(updateVariable, 4000);
                            var typewriter = new Typewriter('#wr', {
                                cursor: "_",
                                delay: "50",
                            });
                            typewriter
                                .typeString('-wc launch ${id}')
                                .pauseFor(200)
                                .pasteString('<br>')
                                .pauseFor(500)
                                .pasteString('<br><b style="color: #cdcdcd;">Loading ${name}...</b>')
                                .pauseFor(1300)
                                .pasteString('<br><b style="color: #a0a0a0;">Loaded! Launching now.</b>')
                                .start();
                                
                        <\/script>
                    </body>
                    </html>
                `;

                // Write the HTML content to the new tab
                newTab.document.open();
                newTab.document.write(htmlContent);
                newTab.document.close();

                // Handle messages from the new tab
                window.addEventListener('message', function(event) {
                    if (event.data === 'variableChanged') {
                        newTab.location.href = `/${id}`;
                    }
                }, false);
            }
        </script>
        <script src="/assets/text/js/global.js"></script>
    </body>
</html>
